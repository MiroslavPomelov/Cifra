# Руководство по заполнению базы данных

## Проблема и решение

Если вы получаете ошибку `getaddrinfo ENOTFOUND shopdb` при запуске `docker-compose up -d`, это означает, что контейнеры не были правильно остановлены или перезапущены. Вот пошаговое решение:

## Шаг 1: Остановка и очистка контейнеров

```bash
cd backend
docker-compose down
```

## Шаг 2: Удаление томов (опционально, но рекомендуется для чистого старта)

```bash
docker volume prune
```

## Шаг 3: Запуск сервисов

```bash
docker-compose up -d
```

## Шаг 4: Проверка статуса сервисов

```bash
docker-compose ps
```

Убедитесь, что все сервисы имеют статус "Up" и "healthy".

## Шаг 5: Заполнение базы данных магазинов

После того как все сервисы запущены и работают:

```bash
# Запуск скрипта заполнения магазинов
docker exec shop-service npm run seed
```

Ожидаемый вывод:
```
Начинаем заполнение магазинов...
✅ Магазин "Цветочный рай" создан с ID: 1
✅ Магазин "Букет-Сервис" создан с ID: 2
✅ Магазин "Розарий" создан с ID: 3
✅ Магазин "Весенние цветы" создан с ID: 4
✅ Магазин "Экзотика" создан с ID: 5
Заполнение магазинов завершено!
```

## Шаг 6: Заполнение базы данных продуктов

```bash
# Запуск скрипта заполнения продуктов
docker exec product-service npm run seed
```

Ожидаемый вывод:
```
Начинаем заполнение продуктов...
✅ Продукт "Букет "Нежность"" создан с ID: 1
✅ Продукт "Композиция "Элегантность"" создан с ID: 2
✅ Продукт "Букет "Солнечное настроение"" создан с ID: 3
...
Заполнение продуктов завершено!
```

## Шаг 7: Проверка данных через API

### Проверка магазинов:
```bash
curl http://localhost:80/shops
```

### Проверка продуктов:
```bash
curl http://localhost:80/products
```

### Проверка избранных продуктов:
```bash
curl http://localhost:80/products/featured
```

## Альтернативное решение (если проблема с сетью)

Если проблема с сетью продолжается, попробуйте:

```bash
# Остановить все контейнеры
docker-compose down

# Удалить все контейнеры и сети
docker system prune -a

# Перезапустить
docker-compose up -d
```

## Проверка логов

Если возникают проблемы, проверьте логи:

```bash
# Логи shop-service
docker logs shop-service

# Логи product-service
docker logs product-service

# Логи api-gateway
docker logs api-gateway
```

## Структура данных

### Магазины:
- **Цветочный рай** (ID: 1) - Эксклюзивные букеты
- **Букет-Сервис** (ID: 2) - Быстрая доставка
- **Розарий** (ID: 3) - Специализация на розах
- **Весенние цветы** (ID: 4) - Тюльпаны и нарциссы
- **Экзотика** (ID: 5) - Экзотические цветы

### Продукты:
Каждый магазин содержит 4 уникальных продукта с профессиональными названиями и описаниями.

## Устранение неполадок

### Ошибка "password_hash violates not-null constraint"
Эта ошибка исправлена в обновленных скриптах. Убедитесь, что вы используете последние версии файлов `seed-shops.ts` и `seed-products.ts`.

### Ошибка "getaddrinfo ENOTFOUND"
Эта ошибка возникает из-за проблем с сетью Docker. Выполните шаги 1-3 выше.

### Продукты не отображаются на фронтенде
1. Убедитесь, что API Gateway работает: `curl http://localhost:80/health`
2. Проверьте, что продукты загружены: `curl http://localhost:80/products`
3. Проверьте логи фронтенда на наличие ошибок

## Проверка работы фронтенда

После успешного заполнения базы данных:

1. Запустите фронтенд: `cd frontend/flower-shop && npm run dev`
2. Откройте http://localhost:3000
3. Проверьте, что на главной странице отображаются продукты из базы данных

## Примечания

- Скрипты заполнения проверяют существование записей перед созданием, поэтому их можно запускать многократно
- Все пароли магазинов установлены как `password123`
- Продукты имеют профессиональные названия и описания
- Цены указаны в рублях
- Эмодзи используются как изображения продуктов
