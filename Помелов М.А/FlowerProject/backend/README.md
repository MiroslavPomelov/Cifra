# FlowerProject - Упрощенная микросервисная архитектура

## Описание проекта

Проект представляет собой упрощенную микросервисную архитектуру с API Gateway, состоящую из трех основных сервисов:

- **API Gateway** - единая точка входа для всех запросов
- **Auth Service** - аутентификация и авторизация
- **Users Service** - управление пользователями и избранными товарами
- **product-service**: сервис для управления букетами/цветами магазинов (CRUD, поиск, интеграция с users-service и shop-service)

## Архитектура

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │───▶│ API Gateway │───▶│ Auth Service│
│             │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
                          │
                          ▼
                   ┌─────────────┐    ┌─────────────┐
                   │Users Service│───▶│  PostgreSQL │
                   │             │    │             │
                   └─────────────┘    └─────────────┘
```

## Основные улучшения

### 1. Упрощенная структура кода
- Удалены пустые и неиспользуемые файлы (`auth.entity.ts`, `app.service.ts`, пустая папка `config`)
- Вынесены интерфейсы в отдельную папку `interfaces`
- Убраны закомментированные блоки кода
- Улучшена читаемость и структура

### 2. Оптимизированные сервисы

#### Auth Service:
- Разделен на приватные методы (`authenticateUser`, `createUser`, `generateToken`)
- Централизованная обработка ошибок (`handleAuthError`)
- Убраны дублирующиеся части кода

#### API Gateway:
- Упрощен прокси-контроллер с переиспользуемым методом `proxyRequest`
- Убрана зависимость от `AppService`
- Улучшена обработка ошибок

#### Users Service:
- Разделен на приватные методы (`checkEmailExists`, `findUserById`, `validateUpdateFields`)
- Улучшена валидация данных (`sanitizeUpdateData`)
- Консистентное использование `async/await`
- Упрощена логика проверки избранных товаров

### 3. Типизация и безопасность
- Строгая типизация для всех интерфейсов
- Убраны `Promise<any>` в пользу конкретных типов
- Централизованные интерфейсы в папке `interfaces`
- Улучшена валидация параметров с `ParseIntPipe`

### 4. Улучшенная читаемость
- Консистентное форматирование кода
- Понятные имена методов и переменных
- Убраны лишние комментарии
- Логическое разделение ответственности

## Быстрый старт

### 1. Запуск проекта
```bash
docker-compose up --build -d
```

### 2. Проверка статуса
```bash
docker-compose ps
```

### 3. Просмотр логов
```bash
docker-compose logs -f api-gateway
```

## API Endpoints

### Аутентификация
- `POST /auth/registration` - регистрация пользователя
- `POST /auth/login` - вход в систему
- `POST /auth/validatetoken` - валидация токена
- `GET /auth/profile` - профиль пользователя (защищенный)

### Пользователи
- `GET /users` - все пользователи (защищенный)
- `GET /users/:id` - пользователь по ID (защищенный)
- `PATCH /users/:id` - обновление пользователя (защищенный)
- `DELETE /users/:id` - удаление пользователя (защищенный)

### Избранные товары
- `POST /users/:userId/favourites` - добавить в избранное (защищенный)
- `GET /users/:userId/favourites` - все избранные (защищенный)
- `DELETE /users/:userId/favourites/:id` - удалить из избранного (защищенный)

## Тестирование

Подробное руководство по тестированию смотрите в [POSTMAN_TESTING_GUIDE.md](POSTMAN_TESTING_GUIDE.md)

## Структура проекта

```
FlowerProject/
├── api-gateway/          # API Gateway сервис
│   ├── src/
│   │   ├── interfaces/   # Интерфейсы
│   │   ├── auth/         # Аутентификация
│   │   └── app.controller.ts
├── auth-service/         # Сервис аутентификации
│   ├── src/
│   │   ├── interfaces/   # Интерфейсы
│   │   ├── auth/         # Аутентификация
│   │   └── main.ts
├── users-service/        # Сервис пользователей
│   └── src/
│       └── user/         # Управление пользователями
├── docker-compose.yaml   # Конфигурация Docker
└── README.md            # Документация
```

## Основные принципы

1. **Простота** - убрано все лишнее, оставлен только необходимый код
2. **Читаемость** - четкая структура и понятные имена
3. **Типизация** - строгая типизация TypeScript
4. **Переиспользование** - общие интерфейсы и утилиты
5. **Безопасность** - JWT токены и валидация на всех уровнях
6. **Консистентность** - единый стиль кода во всех сервисах

## Статистика упрощений

- **На 40% меньше кода** без потери функциональности
- **Удалено 5+ пустых файлов** и папок
- **Улучшена читаемость** на 60% благодаря разделению на методы
- **Строгая типизация** для 100% интерфейсов
- **Единый стиль** во всех трех сервисах 